{% extends 'base.html' %}

{% block content %}

    <div class="card mt-5">
      <h5 class="card-header">{{product.name}}</h5>
      <div class="card-body" id ="card">
        <!-- Big Image -->
        {% if product.main_img_short.img.url %}
        <figure>
          <img class="my-2" id='currentImg' src="{{ product.main_img_short.img.url }}" class="img-fluid" alt="Picture">
          <figcaption id='currentText'>{{ product.main_img_short.description }}</figcaption>
        </figure>
        {% endif %}
        <h5 class="card-title"> {{product.price}} </h5>
        <!-- Thumbnails -->
        {% for image in images %}
          {% if image.thumbnail %}
          <img id="thumbnail_{{image.id}}" src="{{image.thumbnail.url}}"
               {% if image.id == product.main_img_short.id %}
               class="img-thumbnail main-thumbnail"
               {% else %}
               class="img-thumbnail"
               {% endif %}
               alt="..."
               onclick="showImage('{{image.img.url}}','{{image.description}}','thumbnail_{{image.id}}');">
          {% endif %}
        {% endfor %}
        <!-- Specific attributes -->
        <!-- Form created based on attributes of available specific products, submitted every time attribute value is
         changed, showing available products with selected attributes -->
        <form method="GET" action="#form" id="form" class="my-2">
          {% for attribute, values in specific_attributes.items %}
            <label for="{{attribute}}" class="form-label">{{attribute}}:</label>
            <select class="form-select" name="{{attribute}}" id="{{attribute}}" onchange="this.form.submit()">
              <option value="">No selection</option>
              {% for value in values %}
                {% if value.selected %}
                <option value="{{value.value}}" selected>{{value.display}}</option>
                {% else %}
                <option value="{{value.value}}">{{value.display}}</option>
                {% endif %}
              {% endfor %}
            </select>
          <br>
          {% endfor %}
         <!-- Add to cart button - showed when there are available products with selected attributes -->
          {% if specific_attributes %}
          <button class="btn btn-primary" type="button" onclick="addCart()">Add to cart</button>
          {% endif %}
          {% if request.GET %}
          <a href="{{request.path}}"><button class="btn btn-secondary" type="button">Reset selections</button></a>
          {% endif %}
          <br>
        </form>
        <p class="card-text my-2">{{product.description}}</p>
        <!-- Naviagtion -->
        <button onclick="history.back()" class="btn btn-secondary" type="button">Go back</button>
      </div>
    </div>
<script type="text/javascript">

function showImage(imgPath, imgText, thumbClicked) {
    var curImage = document.getElementById('currentImg');
    var curText = document.getElementById('currentText');
    var thumb = document.getElementById(thumbClicked);
    var all_thumbs = document.getElementById("card").getElementsByClassName("img-thumbnail");
    for (let i = 0; i < all_thumbs.length; i++) {
        all_thumbs[i].classList.remove('border');
        all_thumbs[i].classList.remove('border-info');
    }
    thumb.classList.add('border');
    thumb.classList.add('border-info');
    curImage.src = imgPath;
    curText.innerText = imgText;
 }

</script>

<script type="text/javascript">
document.addEventListener("DOMContentLoaded", () => {
  var mainThumb = document.getElementById("card").getElementsByClassName("main-thumbnail");
  if (mainThumb.length >0) {
    mainThumb[0].classList.add('border');
    mainThumb[0].classList.add('border-info');
    }
});
</script>

<script type="text/javascript">
function addCart(){
  var form = document.getElementById('form');
  const hiddenField = document.createElement('input');
  hiddenField.type = 'hidden';
  hiddenField.name = 'add_cart';
  hiddenField.value = '1';
  form.appendChild(hiddenField);
  document.body.appendChild(form);
  form.submit()
}
</script>
{% endblock %}
